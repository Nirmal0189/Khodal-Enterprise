<!DOCTYPE html>
<html lang="gu">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Khodal Enterprize</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --bg: #0f172a;
      --panel: #111827;
      --muted: #1f2937;
      --card: #0b1220;
      --text: #e5e7eb;
      --sub: #9ca3af;
      --brand: #22d3ee;
      --accent: #a78bfa;
      --good: #34d399;
      --warn: #f59e0b;
      --bad: #f87171;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 18px;
      --transition: all 0.3s ease;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    html, body {
      height: 100%;
      font-family: 'Segoe UI', system-ui, -apple-system, Roboto, Helvetica, Arial, sans-serif;
    }
    
    body {
      background: linear-gradient(120deg, var(--bg), #0b1220 40%, #0a1224);
      color: var(--text);
      font-size: 15px;
      line-height: 1.6;
      overflow-x: hidden;
    }
    
    a {
      color: inherit;
      text-decoration: none;
    }
    
    /* Layout */
    .app {
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    
    /* Header */
    .header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px 20px;
      background: rgba(17, 24, 39, 0.9);
      backdrop-filter: blur(8px);
      border-bottom: 1px solid #1f2937;
      position: sticky;
      top: 0;
      z-index: 100;
    }
    
    .brand {
      display: flex;
      gap: 12px;
      align-items: center;
    }
    
    .logo {
      width: 40px;
      height: 40px;
      border-radius: 12px;
      
      box-shadow: var(--shadow);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 18px;
    }
    .logo img {
      max-width: 110%;
      max-height: 100%;
      border-radius: 12px;
      object-fit: cover;
      
    }
    
    .brand-text h1 {
      font-size: 18px;
      margin: 0;
      font-weight: 700;
    }
    
    .muted {
      color: var(--sub);
      font-size: 13px;
    }
    
    /* Main content layout */
    .main-container {
      display: flex;
      flex: 1;
      position: relative;
    }
    
    .content {
      flex: 1;
      padding: 24px;
      overflow-y: auto;
      transition: var(--transition);
      width: 100%;
    }
    
    /* Panel and controls */
    .panel {
      background: black;
      border: 1px solid gray;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 16px;
      margin-bottom: 20px;
    }
    
    .controls {
      display: grid;
      gap: 16px;
    }
    
    .control {
      display: grid;
      gap: 8px;
    }
    
    label {
      font-size: 13px;
      color: var(--sub);
      font-weight: 500;
    }
    
    input, select, button, textarea {
      background: #0b1324;
      border: 1px solid #1f2937;
      color: var(--text);
      padding: 12px 14px;
      border-radius: 12px;
      outline: none;
      font-family: inherit;
      font-size: 14px;
      transition: var(--transition);
    }
    
    input:focus, select:focus, textarea:focus {
      border-color: var(--brand);
      box-shadow: 0 0 0 3px rgba(34,211,238,.15);
    }
    
    /* Buttons */
    button {
      cursor: pointer;
      border: 1px solid #21324a;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      font-weight: 500;
      transition: var(--transition);
    }
    
    .btn {
      padding: 12px 16px;
      border-radius: 12px;
      background: linear-gradient(180deg, #0f1a2e, #0a1425);
      border: 1px solid #1e2a43;
    }
    
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(0,0,0,0.2);
    }
    
    .btn.primary {
      background: linear-gradient(180deg, #0d2b36, #0b1f2a);
      border-color: #1f3d4a;
    }
    
    .btn.brand {
      background: linear-gradient(180deg, rgba(34,211,238,.2), rgba(167,139,250,.15));
      border: 1px solid rgba(34,211,238,.5);
    }
    
    .btn.warn {
      background: linear-gradient(180deg, rgba(245,158,11,.2), rgba(245,158,11,.08));
      border: 1px solid rgba(245,158,11,.5);
    }
    
    .btn.bad {
      background: linear-gradient(180deg, rgba(248,113,113,.2), rgba(248,113,113,.08));
      border: 1px solid rgba(248,113,113,.5);
    }
    
    .btn-sm {
      padding: 8px 12px;
      font-size: 13px;
    }
    
    .btn-icon {
      width: 36px;
      height: 36px;
      padding: 0;
      border-radius: 50%;
    }
    
    /* Topbar and search */
    .topbar {
      display: flex;
      gap: 16px;
      flex-wrap: wrap;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }
    
    .searchbar {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }
    
    .search-wrapper {
      position: relative;
      flex: 1;
      min-width: 240px;
    }
    
    .search-wrapper i {
      position: absolute;
      left: 14px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--sub);
      z-index: 1;
    }
    
    .search-wrapper input {
      width: 100%;
      padding-left: 40px;
      position: relative;
    }
    
    /* Stats */
    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin: 20px 0;
    }
    
    .stat {
      padding: 16px;
      border-radius: 16px;
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border: 1px solid #1f2937;
      transition: var(--transition);
    }
    
    .stat:hover {
      transform: translateY(-3px);
      box-shadow: var(--shadow);
    }
    
    .stat h3 {
      margin: 0 0 8px;
      font-size: 14px;
      color: var(--sub);
      font-weight: 500;
    }
    
    .stat .v {
      font-size: 24px;
      font-weight: 700;
      color: var(--brand);
    }
    
    /* Grid and cards - IMPROVED FOR MOBILE */
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
    }
    
    .card {
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border: 1px solid #1f2937;
      border-radius: 18px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      transition: var(--transition);
      position: relative;
    }
    
    .card:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow);
      border-color: rgba(34,211,238,.3);
    }
    
    .thumb {
      aspect-ratio: 1/1;
      background: #0c1426;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #64748b;
      font-size: 12px;
      overflow: hidden;
      position: relative;
    }
    
    .thumb img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: var(--transition);
    }
    
    .card:hover .thumb img {
      transform: scale(1.05);
    }
    
    .card-body {
      padding: 16px;
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    
    .title {
      font-weight: 700;
      overflow: hidden;
      text-overflow: ellipsis;
      margin-bottom: 4px;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      line-clamp: 2;
      -webkit-box-orient: vertical;
      height: 2.8em;
      line-height: 1.4;
    }
    
    .sub {
      font-size: 13px;
      color: var(--sub);
      margin-bottom: 12px;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    
    .row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
    }
    
    .row.wrap {
      flex-wrap: wrap;
    }
    
    .chip {
      font-size: 12px;
      color: #cbd5e1;
      background: #0a1222;
      border: 1px solid #1f2937;
      padding: 4px 10px;
      border-radius: 999px;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      white-space: nowrap;
    }
    
    .footer {
      display: flex;
      gap: 8px;
      margin-top: auto;
      padding-top: 12px;
      flex-wrap: wrap;
    }
    
    .footer .btn {
      flex: 1;
      min-width: 70px;
      justify-content: center;
      font-size: 10px;
    }
    
    /* Table view */
    .table-container {
      overflow-x: auto;
      border-radius: 16px;
      margin: 20px 0;
      -webkit-overflow-scrolling: touch;
    }
    
    table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      min-width: 600px;
    }
    
    th, td {
      text-align: left;
      padding: 14px 16px;
      white-space: nowrap;
    }
    
    thead {
      position: sticky;
      top: 0;
      z-index: 10;
    }
    
    thead th {
      font-size: 13px;
      color: var(--sub);
      font-weight: 600;
      background: rgba(11, 19, 36, 0.95);
      backdrop-filter: blur(8px);
      padding: 16px;
      border-bottom: 1px solid #1f2937;
    }
    
    tbody tr {
      background: #0b1324;
      border: 1px solid #1f2937;
      transition: var(--transition);
    }
    
    tbody tr:hover {
      background: rgba(17, 24, 39, 0.6);
    }
    
    tbody td {
      border-top: 1px solid #1f2937;
    }
    
    tbody td:first-child {
      border-left: 1px solid #1f2937;
      border-radius: 10px 0 0 10px;
    }
    
    tbody td:last-child {
      border-right: 1px solid #1f2937;
      border-radius: 0 10px 10px 0;
    }
    
    /* Modals */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.7);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 20px;
      z-index: 1000;
      backdrop-filter: blur(5px);
    }
    
    .modal {
      width: min(920px, 96vw);
      max-height: 90vh;
      overflow: auto;
      background: linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.03));
      border: 1px solid #1f2937;
      border-radius: 20px;
      box-shadow: var(--shadow);
      animation: modalFadeIn 0.3s ease;
    }
    
    @keyframes modalFadeIn {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .modal header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 16px 20px;
      border-bottom: 1px solid #1f2937;
      position: sticky;
      top: 0;
      background: rgba(15,23,42,.95);
      backdrop-filter: blur(6px);
      z-index: 5;
    }
    
    .modal .body {
      padding: 20px;
    }
    
    /* Empty state */
    .empty {
      padding: 40px 24px;
      color: var(--sub);
      text-align: center;
      border: 1px dashed #334155;
      border-radius: 16px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 16px;
    }
    
    .empty i {
      font-size: 48px;
      opacity: 0.5;
    }
    
    /* Toast notifications */
    .toast {
      position: fixed;
      bottom: 20px;
      right: 20px;
      padding: 12px 20px;
      background: var(--panel);
      border: 1px solid #1f2937;
      border-radius: 12px;
      box-shadow: var(--shadow);
      display: flex;
      align-items: center;
      gap: 10px;
      z-index: 1000;
      transform: translateY(100px);
      opacity: 0;
      transition: all 0.3s ease;
      max-width: 90vw;
    }
    
    .toast.show {
      transform: translateY(0);
      opacity: 1;
    }
    
    .toast.success {
      border-left: 4px solid var(--good);
    }
    
    .toast.error {
      border-left: 4px solid var(--bad);
    }
    
    .toast.warning {
      border-left: 4px solid var(--warn);
    }
    
    /* Controls section */
    .controls-section {
      margin-bottom: 24px;
    }
    
    /* Mobile menu */
    .mobile-menu-btn {
      display: none;
      background: none;
      border: none;
      color: var(--text);
      font-size: 24px;
      cursor: pointer;
    }
    
    /* Responsive design - IMPROVED MOBILE STYLING */
    @media (max-width: 1024px) {
      .grid {
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      }
    }
    
    @media (max-width: 900px) {
      .grid {
        grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      }
    }
    
    @media (max-width: 768px) {
      .header {
        padding: 14px 16px;
      }
      
      .mobile-menu-btn {
        display: block;
      }
      
      .content {
        padding: 20px 16px;
        width: 100%;
      }
      
      .topbar {
        flex-direction: column;
        align-items: stretch;
        gap: 16px;
      }
      
      .searchbar {
        flex-direction: column;
        width: 100%;
      }
      
      .search-wrapper {
        min-width: 100%;
      }
      
      .stats {
        grid-template-columns: 1fr 1fr;
      }
      
      /* MOBILE GRID: Show 2 cards on smaller screens */
      .grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 16px;
      }
      
      .modal {
        width: 95vw;
        max-height: 85vh;
        margin: 0;
      }
      
      .modal .body {
        padding: 16px;
      }
      
      /* Improved mobile card styling */
      .card {
        margin-bottom: 0;
      }
      
      .footer {
        justify-content: space-between;
        gap: 4px;
      }
      
      .footer .btn {
        flex: 0 0 auto;
        width: 36px;
        height: 36px;
        padding: 0;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      
      .footer .btn span {
        display: none;
      }
      
      .footer .btn i {
        margin: 0;
        font-size: 14px;
      }
      
      /* Make card content more compact for mobile */
      .card-body {
        padding: 12px;
      }
      
      .title {
        font-size: 14px;
        height: 2.6em;
      }
      
      .sub {
        font-size: 12px;
        margin-bottom: 8px;
      }
      
      .chip {
        font-size: 10px;
        padding: 3px 6px;
      }
    }
    
    @media (max-width: 640px) {
      /* MOBILE GRID: Show 2 cards on medium-small screens */
      .grid {
        grid-template-columns: repeat(2, 1fr);
      }
      
      /* Adjust stats for smaller screens */
      .stats {
        grid-template-columns: 1fr;
        gap: 12px;
      }
      
      .stat {
        padding: 12px;
      }
      
      .stat .v {
        font-size: 20px;
      }
    }
    
    @media (max-width: 480px) {
      .btn-text {
        display: none;
      }
      
      .btn-icon {
        width: 42px;
        height: 42px;
      }
      
      .searchbar .btn {
        width: 100%;
        justify-content: center;
      }
      
      .topbar h2 {
        font-size: 1.4rem;
        text-align: center;
      }
      
      /* MOBILE GRID: Show 2 cards on very small screens */
      .grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
      }
      
      /* Improved modal for mobile */
      .modal .body {
        padding: 12px;
      }
      
      .modal header {
        padding: 12px 16px;
      }
      
      /* Improved form controls for mobile */
      .control {
        width: 100%;
      }
      
      .row.wrap {
        gap: 12px;
      }
      
      /* Card adjustments for very small screens */
      .footer .btn {
        width: 32px;
        height: 32px;
      }
      
      .footer .btn i {
        font-size: 12px;
      }
    }
    
    @media (max-width: 360px) {
      /* MOBILE GRID: Show 2 cards on smallest screens */
      .grid {
        grid-template-columns: repeat(2, 1fr);
      }
      
      /* Adjust card footer for smallest screens */
      .footer {
        gap: 3px;
      }
      
      .footer .btn {
        width: 30px;
        height: 30px;
      }
      
      .footer .btn i {
        font-size: 11px;
      }
      
      .chip {
        font-size: 9px;
        padding: 2px 5px;
      }
    }
    
    /* Additional mobile improvements */
    @media (max-width: 768px) {
      /* Improve touch targets for mobile */
      button, .btn, input[type="button"], input[type="submit"] {
        min-height: 44px;
      }
      
      /* Improve form elements for mobile */
      input, select, textarea {
        font-size: 16px; /* Prevents zoom on iOS */
      }
      
      /* Better table responsiveness */
      .table-container {
        border: 1px solid #1f2937;
        border-radius: 12px;
      }
      
      /* Card hover effects disabled on touch devices */
      @media (hover: none) {
        .card:hover {
          transform: none;
          box-shadow: none;
        }
        
        .btn:hover {
          transform: none;
          box-shadow: none;
        }
        
        .stat:hover {
          transform: none;
          box-shadow: none;
        }
      }
    }
    
    /* Utility classes */
    .hidden {
      display: none !important;
    }
    
    .text-center {
      text-align: center;
    }
    
    .mt-1 { margin-top: 8px; }
    .mt-2 { margin-top: 16px; }
    .mt-3 { margin-top: 24px; }
    
    .mb-1 { margin-bottom: 8px; }
    .mb-2 { margin-bottom: 16px; }
    .mb-3 { margin-bottom: 24px; }
  </style>
</head>
<body>
  <div class="app">
    <header class="header">
      <div class="brand">
        <div class="logo"><i><img src="KHODAL.png" alt="" srcset=""></i></div>
        <div class="brand-text">
          <h1>Khodal Enterprise</h1>
          <div class="muted">KHODAL ENTERPRISE</div>
        </div>
      </div>
      <button class="mobile-menu-btn">
        <i class="fas fa-bars"></i>
      </button>
    </header>

    <div class="main-container">
      <main class="content">
        <div class="controls-section">
          <div class="panel controls">
            <div class="control">
              <label for="q">Search (નામ / SKU / supplier)</label>
              <div class="search-wrapper">
                <i class="fas fa-search"></i>
                <input id="q" type="search" placeholder="Search products..." />
              </div>
            </div>
            <div class="row">
              <div class="control" style="flex:1">
                <label for="sortBy">Sort</label>
                <select id="sortBy">
                  <option value="name">Name (A–Z)</option>
                  <option value="recent">Recently Purchased</option>
                  <option value="qty">Total Qty (High→Low)</option>
                  <option value="created">Recently Added</option>
                </select>
              </div>
              <div class="control" style="width:130px">
                <label for="viewMode">View</label>
                <select id="viewMode">
                  <option value="grid">Grid</option>
                  <option value="table">Table</option>
                </select>
              </div>
            </div>
            <div class="row wrap">
              <button class="btn brand" id="addItemBtn">
                <i class="fas fa-plus"></i>
                <span>Add Item</span>
              </button>
              <button class="btn" id="importBtn">
                <i class="fas fa-file-import"></i>
                <span>Import</span>
              </button>
              <button class="btn" id="exportBtn">
                <i class="fas fa-file-export"></i>
                <span>Export</span>
              </button>
              <button class="btn warn" id="bulkAddBtn">
                <i class="fas fa-copy"></i>
                <span>Bulk Add</span>
              </button>
              <button class="btn bad" id="resetBtn">
                <i class="fas fa-trash"></i>
                <span>Reset</span>
              </button>
            </div>
            <p class="muted" style="font-size:12px;margin:8px 0 0">
              <i class="fas fa-lightbulb"></i> Tip: ફોટા upload localStorage માં સેવે છે. 200 items માટે OK, પણ જો બહુ મોટા ફોટા હોય તો Export JSON backup રાખજો.
            </p>
          </div>
        </div>

        <div class="topbar">
          <h2 style="margin:0">તમારા Products</h2>
          <div class="searchbar">
            <button class="btn brand" id="quickPurchaseBtn">
              <i class="fas fa-bolt"></i>
              <span>Quick Purchase</span>
            </button>
            <button class="btn" id="statsBtn">
              <i class="fas fa-chart-bar"></i>
              <span>View Stats</span>
            </button>
          </div>
        </div>

        <section class="stats" id="stats">
          <div class="stat">
            <h3><i class="fas fa-cube"></i> Total Products</h3>
            <div class="v" id="statProducts">0</div>
          </div>
          <div class="stat">
            <h3><i class="fas fa-layer-group"></i> Total Qty Purchased</h3>
            <div class="v" id="statQty">0</div>
          </div>
          <div class="stat">
            <h3><i class="fas fa-calendar-alt"></i> Last Purchase Date</h3>
            <div class="v" id="statLast">–</div>
          </div>
          <div class="stat">
            <h3><i class="fas fa-truck"></i> Suppliers</h3>
            <div class="v" id="statSuppliers">0</div>
          </div>
        </section>

        <div id="list" class="grid"></div>
        
        <div id="tableWrap" class="hidden">
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>Photo</th>
                  <th>Name</th>
                  <th>SKU</th>
                  <th>Supplier</th>
                  <th>Total Qty</th>
                  <th>Last Purchase</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="tableBody"></tbody>
            </table>
          </div>
        </div>
        
        <div id="emptyState" class="empty hidden">
          <i class="fas fa-box-open"></i>
          <h3>No products found</h3>
          <p>Add your first product to get started</p>
          <button class="btn brand" id="addFirstItemBtn">
            <i class="fas fa-plus"></i>
            Add Your First Item
          </button>
        </div>
      </main>
    </div>
  </div>

  <!-- Modal: Add / Edit Item -->
  <div class="modal-backdrop" id="itemModalWrap">
    <div class="modal">
      <header>
        <strong id="itemModalTitle"><i class="fas fa-cube"></i> Add Item</strong>
        <button class="btn" onclick="closeItemModal()">
          <i class="fas fa-times"></i> Close
        </button>
      </header>
      <div class="body">
        <div class="row wrap">
          <div class="control" style="flex:1;min-width:220px">
            <label><i class="fas fa-tag"></i> Item Name</label>
            <input id="f_name" placeholder="ઉદાહરણ: SS Bowl 12cm" />
          </div>
          <div class="control" style="width:180px">
            <label><i class="fas fa-barcode"></i> SKU / Code</label>
            <input id="f_sku" placeholder="BW-12" />
          </div>
        </div>
        
        <div class="row wrap mt-2">
          <div class="control" style="flex:1;min-width:200px">
            <label><i class="fas fa-truck"></i> Supplier</label>
            <input id="f_supplier" placeholder="ABC Metals" />
          </div>
          <div class="control" style="width:160px">
            <label><i class="fas fa-folder"></i> Category</label>
            <input id="f_category" placeholder="Kitchen" />
          </div>
        </div>
        
        <div class="row wrap mt-2">
          <div class="control" style="width:160px">
            <label><i class="fas fa-box-open"></i> Opening Qty</label>
            <input id="f_openQty" type="number" min="0" value="0" />
          </div>
          <div class="control" style="width:180px">
            <label><i class="fas fa-balance-scale"></i> Unit (pcs/kg)</label>
            <input id="f_unit" placeholder="pcs" value="pcs" />
          </div>
          <div class="control" style="flex:1;min-width:240px">
            <label><i class="fas fa-camera"></i> Photo</label>
            <input id="f_photo" type="file" accept="image/*" />
          </div>
        </div>
        
        <div class="row wrap mt-3">
          <button class="btn brand" id="saveItemBtn">
            <i class="fas fa-save"></i> Save Item
          </button>
          <button class="btn" id="saveItemAddMoreBtn">
            <i class="fas fa-save"></i> Save & Add Another
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal: Product Detail -->
  <div class="modal-backdrop" id="detailModalWrap">
    <div class="modal">
      <header>
        <strong id="detailTitle"><i class="fas fa-info-circle"></i> Item Details</strong>
        <button class="btn" onclick="closeDetail()">
          <i class="fas fa-times"></i> Close
        </button>
      </header>
      <div class="body" id="detailBody"></div>
    </div>
  </div>

  <!-- Modal: Quick Purchase -->
  <div class="modal-backdrop" id="purchaseModalWrap">
    <div class="modal">
      <header>
        <strong><i class="fas fa-shopping-cart"></i> Quick Purchase</strong>
        <button class="btn" onclick="closePurchase()">
          <i class="fas fa-times"></i> Close
        </button>
      </header>
      <div class="body">
        <div class="row wrap">
          <div class="control" style="flex:1;min-width:260px">
            <label><i class="fas fa-cube"></i> Choose Item</label>
            <select id="p_item"></select>
          </div>
          <div class="control" style="width:150px">
            <label><i class="fas fa-hashtag"></i> Quantity</label>
            <input id="p_qty" type="number" min="1" value="1" />
          </div>
          <div class="control" style="width:180px">
            <label><i class="fas fa-calendar"></i> Purchase Date</label>
            <input id="p_date" type="date" />
          </div>
          <div class="control" style="width:180px">
            <label><i class="fas fa-sticky-note"></i> Price/Notes (optional)</label>
            <input id="p_note" placeholder="₹ / note" />
          </div>
        </div>
        <div class="row wrap" style="margin-top:10px">
          <button class="btn brand" id="p_save">
            <i class="fas fa-check"></i> Add Purchase
          </button>
        </div>
      </div>
    </div>
  </div>

  <input type="file" id="importFile" class="hidden" accept="application/json" />
  
  <div id="toast" class="toast">
    <i class="fas fa-check-circle"></i>
    <span id="toastMessage"></span>
  </div>

  <script>
    /*** Simple localStorage DB ***/
    const DB_KEY = 'ss_inv_v1';
    const uid = () => Math.random().toString(36).slice(2)+Date.now().toString(36);
    const todayStr = ()=> new Date().toISOString().slice(0,10);
    const fmtDate = (d)=> new Date(d).toLocaleDateString('en-IN',{year:'numeric',month:'short',day:'2-digit'});

    const load = () => JSON.parse(localStorage.getItem(DB_KEY)||'{"items":[],"purchases":[]}');
    const save = (data) => localStorage.setItem(DB_KEY, JSON.stringify(data));

    let state = load();

    // Elements
    const listEl = document.getElementById('list');
    const tableWrap = document.getElementById('tableWrap');
    const tableBody = document.getElementById('tableBody');
    const statProducts = document.getElementById('statProducts');
    const statQty = document.getElementById('statQty');
    const statLast = document.getElementById('statLast');
    const statSuppliers = document.getElementById('statSuppliers');
    const emptyState = document.getElementById('emptyState');

    // Search & Sort
    const q = document.getElementById('q');
    const sortBy = document.getElementById('sortBy');
    const viewMode = document.getElementById('viewMode');

    // Modals
    const itemModalWrap = document.getElementById('itemModalWrap');
    const itemModalTitle = document.getElementById('itemModalTitle');
    const f_name = document.getElementById('f_name');
    const f_sku = document.getElementById('f_sku');
    const f_supplier = document.getElementById('f_supplier');
    const f_category = document.getElementById('f_category');
    const f_openQty = document.getElementById('f_openQty');
    const f_unit = document.getElementById('f_unit');
    const f_photo = document.getElementById('f_photo');
    let editingId = null;

    const detailModalWrap = document.getElementById('detailModalWrap');
    const detailTitle = document.getElementById('detailTitle');
    const detailBody = document.getElementById('detailBody');

    const purchaseModalWrap = document.getElementById('purchaseModalWrap');
    const p_item = document.getElementById('p_item');
    const p_qty = document.getElementById('p_qty');
    const p_date = document.getElementById('p_date');
    const p_note = document.getElementById('p_note');

    /*** UI Enhancements ***/
    // Toast notification function
    function showToast(message, type = 'success') {
      const toast = document.getElementById('toast');
      const toastMessage = document.getElementById('toastMessage');
      const icon = toast.querySelector('i');
      
      toastMessage.textContent = message;
      toast.className = 'toast';
      toast.classList.add(type, 'show');
      
      // Set appropriate icon
      if (type === 'success') {
        icon.className = 'fas fa-check-circle';
      } else if (type === 'error') {
        icon.className = 'fas fa-exclamation-circle';
      } else if (type === 'warning') {
        icon.className = 'fas fa-exclamation-triangle';
      }
      
      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    }

    /*** Helpers ***/
    function calcTotals(){
      const items = state.items;
      const pmap = new Map(items.map(i=>[i.id,0]));
      let lastDate = null; const suppliers = new Set();
      for(const p of state.purchases){
        pmap.set(p.itemId, (pmap.get(p.itemId)||0) + Number(p.qty||0));
        if(!lastDate || new Date(p.date)>new Date(lastDate)) lastDate = p.date;
      }
      items.forEach(i=> suppliers.add((i.supplier||'').trim()));
      statProducts.textContent = String(items.length);
      statQty.textContent = [...pmap.values()].reduce((a,b)=>a+b,0);
      statLast.textContent = lastDate? fmtDate(lastDate) : '–';
      statSuppliers.textContent = [...suppliers].filter(Boolean).length;
    }

    function itemTotalQty(id){
      return state.purchases.filter(p=>p.itemId===id).reduce((a,b)=>a+Number(b.qty||0),0);
    }

    function lastPurchaseDate(id){
      const ps = state.purchases.filter(p=>p.itemId===id);
      if(ps.length===0) return null;
      return ps.sort((a,b)=> new Date(b.date)-new Date(a.date))[0].date;
    }

    function render(){
      calcTotals();
      const term = (q.value||'').toLowerCase();
      let items = state.items.filter(i=>{
        const blob = `${i.name} ${i.sku||''} ${i.supplier||''} ${i.category||''}`.toLowerCase();
        return blob.includes(term);
      });
      const s = sortBy.value;
      items.sort((a,b)=>{
        if(s==='name') return a.name.localeCompare(b.name);
        if(s==='recent') return new Date(lastPurchaseDate(b.id)||0) - new Date(lastPurchaseDate(a.id)||0);
        if(s==='qty') return itemTotalQty(b.id) - itemTotalQty(a.id);
        if(s==='created') return (b.created||0) - (a.created||0);
        return 0;
      });

      // Show empty state if no items
      if (items.length === 0) {
        emptyState.classList.remove('hidden');
        listEl.classList.add('hidden');
        tableWrap.classList.add('hidden');
      } else {
        emptyState.classList.add('hidden');
        
        const vm = viewMode.value;
        if(vm==='grid'){
          tableWrap.classList.add('hidden');
          listEl.classList.remove('hidden');
          listEl.innerHTML = items.map(cardHTML).join('');
        } else {
          listEl.classList.add('hidden');
          tableWrap.classList.remove('hidden');
          tableBody.innerHTML = items.map(rowHTML).join('');
        }
      }
    }

    function cardHTML(i){
      const qty = itemTotalQty(i.id);
      const last = lastPurchaseDate(i.id);
      return `<div class="card">
        <div class="thumb">${i.photo?`<img src="${i.photo}" alt="${escapeHtml(i.name)}"/>`:'<i class="fas fa-image"></i> No Photo'}</div>
        <div class="card-body">
          <div class="title">${escapeHtml(i.name)}</div>
          <div class="sub">SKU: ${escapeHtml(i.sku||'-')} • ${escapeHtml(i.unit||'pcs')}</div>
          <div class="row" style="margin-top:8px">
            <span class="chip"><i class="fas fa-layer-group"></i> Qty: ${qty}</span>
            <span class="chip"><i class="fas fa-calendar"></i> ${last? fmtDate(last):'–'}</span>
          </div>
          <div class="footer">
            <button class="btn brand" onclick="openDetail('${i.id}')"><i class="fas fa-eye"></i> <span class="btn-text">Open</span></button>
            <button class="btn" onclick="openPurchaseFor('${i.id}')"><i class="fas fa-cart-plus"></i> <span class="btn-text">Purchase</span></button>
            <button class="btn" onclick="editItem('${i.id}')"><i class="fas fa-edit"></i> <span class="btn-text">Edit</span></button>
            <button class="btn bad" onclick="deleteItem('${i.id}')"><i class="fas fa-trash"></i> <span class="btn-text">Delete</span></button>
          </div>
        </div>
      </div>`
    }

    function rowHTML(i){
      const qty = itemTotalQty(i.id);
      const last = lastPurchaseDate(i.id);
      return `<tr>
        <td>${i.photo?`<img src="${i.photo}" alt="${escapeHtml(i.name)}" style="width:48px;height:48px;object-fit:cover;border-radius:8px"/>`:'–'}</td>
        <td><strong>${escapeHtml(i.name)}</strong><div class="sub">${escapeHtml(i.category||'')}</div></td>
        <td>${escapeHtml(i.sku||'-')}</td>
        <td>${escapeHtml(i.supplier||'-')}</td>
        <td>${qty} ${escapeHtml(i.unit||'')}</td>
        <td>${last? fmtDate(last):'–'}</td>
        <td>
          <button class="btn btn-sm" onclick="openDetail('${i.id}')"><i class="fas fa-eye"></i></button>
          <button class="btn btn-sm" onclick="openPurchaseFor('${i.id}')"><i class="fas fa-cart-plus"></i></button>
          <button class="btn btn-sm" onclick="editItem('${i.id}')"><i class="fas fa-edit"></i></button>
          <button class="btn btn-sm bad" onclick="deleteItem('${i.id}')"><i class="fas fa-trash"></i></button>
        </td>
      </tr>`
    }

    function escapeHtml(str=''){
      return String(str).replace(/[&<>"]/g, s=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;"}[s]));
    }

    /*** Item CRUD ***/
    function openItemModal(editId=null){
      editingId = editId;
      itemModalTitle.textContent = editId? '<i class="fas fa-edit"></i> Edit Item' : '<i class="fas fa-plus"></i> Add Item';
      if(editId){
        const i = state.items.find(x=>x.id===editId);
        f_name.value=i.name||''; f_sku.value=i.sku||''; f_supplier.value=i.supplier||''; f_category.value=i.category||''; f_openQty.value=i.openQty||0; f_unit.value=i.unit||'pcs'; f_photo.value='';
      } else {
        f_name.value=''; f_sku.value=''; f_supplier.value=''; f_category.value=''; f_openQty.value=0; f_unit.value='pcs'; f_photo.value='';
      }
      itemModalWrap.style.display='flex';
    }
    function closeItemModal(){ itemModalWrap.style.display='none'; }

    async function fileToBase64(file){
      if(!file) return null;
      return new Promise((res,rej)=>{
        const r = new FileReader();
        r.onload=()=>res(r.result);
        r.onerror=rej; r.readAsDataURL(file);
      });
    }

    async function saveItem(addAnother=false){
      const name=f_name.value.trim(); if(!name){ showToast('Name is required', 'error'); return; }
      const item = editingId? state.items.find(x=>x.id===editingId) : {id:uid(), created:Date.now()};
      item.name = name; item.sku=f_sku.value.trim(); item.supplier=f_supplier.value.trim(); item.category=f_category.value.trim(); item.unit=f_unit.value.trim()||'pcs';
      if(!editingId){ item.openQty=Number(f_openQty.value||0); }
      if(f_photo.files && f_photo.files[0]){
        const b64 = await fileToBase64(f_photo.files[0]);
        item.photo = b64;
      }
      if(editingId){
        state.items = state.items.map(x=> x.id===editingId? item : x);
        showToast('Item updated successfully');
      } else {
        state.items.push(item);
        if(item.openQty>0){ state.purchases.push({id:uid(), itemId:item.id, qty:Number(item.openQty), date: todayStr(), note:'Opening'}); }
        showToast('Item added successfully');
      }
      save(state); render();
      if(addAnother){ openItemModal(null); } else { closeItemModal(); }
    }

    function editItem(id){ openItemModal(id); }
    function deleteItem(id){
      if(!confirm('Delete this item and its purchase records?')) return;
      state.items = state.items.filter(i=>i.id!==id);
      state.purchases = state.purchases.filter(p=>p.itemId!==id);
      save(state); 
      showToast('Item deleted successfully');
      render();
    }

    /*** Detail & Purchases ***/
    function openDetail(id){
      const i = state.items.find(x=>x.id===id);
      detailTitle.textContent = ` ${i.name}`;
      const ps = state.purchases.filter(p=>p.itemId===id).sort((a,b)=> new Date(b.date)-new Date(a.date));
      const qty = itemTotalQty(id);
      detailBody.innerHTML = `
        <div class="row wrap" style="gap:16px;align-items:flex-start">
          <div class="panel" style="padding:12px;max-width:340px">
            <div class="thumb" style="border-radius:12px;overflow:hidden">${i.photo?`<img src="${i.photo}" alt="${escapeHtml(i.name)}"/>`:'<i class="fas fa-image"></i> No Photo'}</div>
            <div style="margin-top:10px" class="sub"><i class="fas fa-barcode"></i> SKU: ${escapeHtml(i.sku||'-')}</div>
            <div class="sub"><i class="fas fa-truck"></i> Supplier: ${escapeHtml(i.supplier||'-')}</div>
            <div class="sub"><i class="fas fa-folder"></i> Category: ${escapeHtml(i.category||'-')}</div>
            <div class="sub"><i class="fas fa-balance-scale"></i> Unit: ${escapeHtml(i.unit||'pcs')}</div>
            <div class="row" style="margin-top:10px"><span class="chip"><i class="fas fa-layer-group"></i> Total Qty: ${qty}</span></div>
            <div class="row" style="margin-top:10px;gap:8px">
              <button class="btn" onclick="openPurchaseFor('${i.id}')"><i class="fas fa-cart-plus"></i> Add Purchase</button>
              <button class="btn" onclick="editItem('${i.id}')"><i class="fas fa-edit"></i> Edit</button>
            </div>
          </div>
          <div class="panel" style="padding:12px;flex:1;min-width:340px">
            <div class="row" style="justify-content:space-between;align-items:center">
              <h3 style="margin:6px 0"><i class="fas fa-history"></i> Purchase History</h3>
              <button class="btn bad" onclick="deleteAllPurchases('${i.id}')"><i class="fas fa-trash"></i> Clear History</button>
            </div>
            ${ps.length?`<table><thead><tr><th>Date</th><th>Qty</th><th>Note</th><th>Action</th></tr></thead><tbody>
                ${ps.map(p=>`<tr><td>${fmtDate(p.date)}</td><td>${p.qty}</td><td>${escapeHtml(p.note||'')}</td><td><button class="btn bad btn-sm" onclick="deletePurchase('${p.id}')"><i class="fas fa-trash"></i></button></td></tr>`).join('')}
            </tbody></table>`: `<div class='empty'><i class="fas fa-history"></i> No purchases yet</div>`}
          </div>
        </div>`;
      detailModalWrap.style.display='flex';
    }
    function closeDetail(){ detailModalWrap.style.display='none'; }

    function deletePurchase(pid){
      state.purchases = state.purchases.filter(p=>p.id!==pid);
      save(state); 
      showToast('Purchase record deleted');
      render();
      // refresh detail if open
      const open = detailModalWrap.style.display==='flex';
      if(open){ const id = (detailTitle.textContent && state.items.find(i=>i.name===detailTitle.textContent)?.id); if(id) openDetail(id); }
    }
    function deleteAllPurchases(itemId){
      if(!confirm('Clear all purchases for this item?')) return;
      state.purchases = state.purchases.filter(p=>p.itemId!==itemId);
      save(state); 
      showToast('All purchase records cleared');
      render(); 
      openDetail(itemId);
    }

    /*** Purchase Modal ***/
    function openPurchase(){
      p_item.innerHTML = state.items.map(i=>`<option value='${i.id}'>${escapeHtml(i.name)} (${escapeHtml(i.sku||'')})</option>`).join('');
      p_date.value = todayStr(); p_qty.value=1; p_note.value='';
      purchaseModalWrap.style.display='flex';
    }
    function openPurchaseFor(itemId){ openPurchase(); p_item.value=itemId; }
    function closePurchase(){ purchaseModalWrap.style.display='none'; }

    function addPurchase(){
      if(!p_item.value){ showToast('Please choose an item', 'error'); return; }
      const rec = { id:uid(), itemId:p_item.value, qty:Number(p_qty.value||0), date: p_date.value||todayStr(), note: p_note.value.trim() };
      if(rec.qty<=0){ showToast('Quantity must be greater than 0', 'error'); return; }
      state.purchases.push(rec); save(state); 
      showToast('Purchase added successfully');
      render(); closePurchase();
    }

    /*** Import/Export/Reset ***/
    function exportJSON(){
      const blob = new Blob([JSON.stringify(state,null,2)],{type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href=url; a.download='ss-inventory.json'; a.click(); URL.revokeObjectURL(url);
      showToast('Data exported successfully');
    }
    function importJSONFile(file){
      const r = new FileReader();
      r.onload=()=>{ 
        try{ 
          const data = JSON.parse(r.result); 
          if(!data.items||!data.purchases) throw new Error('Invalid format'); 
          state=data; 
          save(state); 
          render(); 
          showToast('Data imported successfully');
        }catch(e){ 
          showToast('Invalid JSON file format', 'error'); 
        } 
      };
      r.readAsText(file);
    }
    function resetData(){ 
      if(confirm('Reset all data? This cannot be undone.')){
        state={items:[],purchases:[]}; 
        save(state); 
        render();
        showToast('All data has been reset');
      } 
    }

    /*** Bulk Add for 200 items (placeholder generator) ***/
    function bulkAdd(){
      if(!confirm('Create 200 sample products?')) return;
      const base = Date.now();
      for(let n=1;n<=200;n++){
        const id=uid();
        state.items.push({id, name:`SS Item ${n}`, sku:`SS-${String(n).padStart(3,'0')}`, supplier: n%5===0? 'Shree Metals' : n%3===0? 'Om Steel' : 'ABC Steel', category: n%2===0? 'Kitchen':'Industrial', unit:'pcs', created: base - n*10000});
        // opening qty random
        const oq = Math.floor(Math.random()*5);
        if(oq>0){ state.purchases.push({id:uid(), itemId:id, qty:oq, date: todayStr(), note:'Opening'}); }
      }
      save(state); 
      showToast('200 sample products created');
      render();
    }

    /*** Wire up ***/
    document.getElementById('addItemBtn').onclick = ()=> openItemModal();
    document.getElementById('saveItemBtn').onclick = ()=> saveItem(false);
    document.getElementById('saveItemAddMoreBtn').onclick = ()=> saveItem(true);
    document.getElementById('addFirstItemBtn').onclick = ()=> openItemModal();

    document.getElementById('quickPurchaseBtn').onclick = openPurchase;
    document.getElementById('p_save').onclick = addPurchase;

    document.getElementById('importBtn').onclick = ()=> document.getElementById('importFile').click();
    document.getElementById('importFile').addEventListener('change', (e)=>{ const f = e.target.files[0]; if(f) importJSONFile(f); e.target.value=''; });
    document.getElementById('exportBtn').onclick = exportJSON;
    document.getElementById('resetBtn').onclick = resetData;
    document.getElementById('bulkAddBtn').onclick = bulkAdd;
    document.getElementById('statsBtn').onclick = () => {
      const statsSection = document.getElementById('stats');
      statsSection.scrollIntoView({ behavior: 'smooth' });
    };

    q.oninput = render; 
    sortBy.onchange = render; 
    viewMode.onchange = render;

    // Close modals on backdrop click
    [itemModalWrap, detailModalWrap, purchaseModalWrap].forEach(el=> {
      el.addEventListener('click', (e)=>{ 
        if(e.target===el){ 
          el.style.display='none'; 
        } 
      });
    });

    // First render
    render();

    // Set today's date as default for purchase date
    p_date.value = todayStr();

    // Expose some functions to window
    window.openDetail = openDetail;
    window.closeDetail = closeDetail;
    window.openPurchaseFor = openPurchaseFor;
    window.deletePurchase = deletePurchase;
    window.deleteAllPurchases = deleteAllPurchases;
    window.editItem = editItem;
    window.deleteItem = deleteItem;
    window.closeItemModal = closeItemModal;
    window.closePurchase = closePurchase;

    // Keyboard shortcuts
    document.addEventListener('keydown',(e)=>{
      if(e.key==='n' && (e.ctrlKey||e.metaKey)){ e.preventDefault(); openItemModal(); }
      if(e.key==='f' && (e.ctrlKey||e.metaKey)){ e.preventDefault(); document.getElementById('q').focus(); }
      if(e.key==='Escape'){ 
        if(itemModalWrap.style.display==='flex') closeItemModal();
        if(detailModalWrap.style.display==='flex') closeDetail();
        if(purchaseModalWrap.style.display==='flex') closePurchase();
      }
    });
  </script>
</body>
</html>